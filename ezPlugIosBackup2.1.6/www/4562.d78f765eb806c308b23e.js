(self.webpackChunkeZPlug=self.webpackChunkeZPlug||[]).push([[4562],{4562:(t,o,n)=>{"use strict";n.r(o),n.d(o,{TransactionPageModule:()=>Y});var e=n(8583),a=n(665),s=n(7823),i=n(5298),r=n(4762),l=n(5466),h=n(6738),c=n(7716),u=n(1188);let m=(()=>{class t{constructor(t,o){this.popoverController=t,this.storage=o,this.selectedFilter=""}ngOnInit(){return(0,r.mG)(this,void 0,void 0,function*(){this.selectedFilter=yield this.storage.getItem("SELECTED_FILTER")})}onSelect(t){this.storage.setItem("SELECTED_FILTER",t.target.value),this.selectedFilter=t.target.value,this.popoverController.dismiss({data:this.selectedFilter})}}return t.\u0275fac=function(o){return new(o||t)(c.Y36(s.Dh),c.Y36(u.V))},t.\u0275cmp=c.Xpm({type:t,selectors:[["app-popovercomponent"]],decls:22,vars:2,consts:[["padding",""],[3,"ngModel","value","ngModelChange","ionChange"],["slot","start","value","all"],["slot","start","value","currentmonth"],["slot","start","value","lastmonth"],["slot","start","value","last3month"]],template:function(t,o){1&t&&(c.TgZ(0,"ion-content",0),c.TgZ(1,"ion-list"),c.TgZ(2,"ion-radio-group",1),c.NdJ("ngModelChange",function(t){return o.selectedFilter=t})("ionChange",function(t){return o.onSelect(t)}),c.TgZ(3,"ion-list-header"),c.TgZ(4,"ion-label"),c._uU(5,"Set Filter"),c.qZA(),c.qZA(),c.TgZ(6,"ion-item"),c.TgZ(7,"ion-label"),c._uU(8,"Show All"),c.qZA(),c._UZ(9,"ion-radio",2),c.qZA(),c.TgZ(10,"ion-item"),c.TgZ(11,"ion-label"),c._uU(12,"This Month"),c.qZA(),c._UZ(13,"ion-radio",3),c.qZA(),c.TgZ(14,"ion-item"),c.TgZ(15,"ion-label"),c._uU(16,"Last Month"),c.qZA(),c._UZ(17,"ion-radio",4),c.qZA(),c.TgZ(18,"ion-item"),c.TgZ(19,"ion-label"),c._uU(20,"Last 3 Month"),c.qZA(),c._UZ(21,"ion-radio",5),c.qZA(),c.qZA(),c.qZA(),c.qZA()),2&t&&(c.xp6(2),c.Q6J("ngModel",o.selectedFilter)("value",o.selectedFilter))},directives:[s.W2,s.q_,s.se,s.QI,a.JJ,a.On,s.yh,s.Q$,s.Ie,s.B7,s.U5],styles:[""]}),t})();var g=n(7906),Z=n(5970),p=n(4471);function T(t,o){if(1&t&&(c.TgZ(0,"ion-item"),c.TgZ(1,"ion-label",0),c.TgZ(2,"h2",9),c._uU(3),c.qZA(),c.TgZ(4,"p"),c.TgZ(5,"span"),c._uU(6,"Units Consumed "),c.qZA(),c._uU(7),c.qZA(),c.TgZ(8,"p"),c._uU(9),c.qZA(),c.qZA(),c.TgZ(10,"ion-label",10),c.TgZ(11,"p",11),c.TgZ(12,"span"),c._uU(13,"\u20b9"),c.qZA(),c._uU(14),c.qZA(),c.TgZ(15,"p"),c._uU(16),c.qZA(),c.qZA(),c.qZA()),2&t){const t=o.$implicit,n=c.oxw(2);c.xp6(3),c.Oqu(t.siteName),c.xp6(4),c.Oqu(n.formatter(t.unitsConsumed)),c.xp6(2),c.Oqu(n.dateFormatter(t.transactionStartTime)),c.xp6(5),c.hij(" ",n.formatter(t.transactionAmount),""),c.xp6(2),c.Oqu(null==t.paymentMode?"NA":t.paymentMode)}}function d(t,o){1&t&&(c.TgZ(0,"ion-label",12),c._uU(1,"No transactions"),c.qZA())}function f(t,o){if(1&t&&(c.TgZ(0,"ion-list"),c.YNc(1,T,17,5,"ion-item",7),c.YNc(2,d,2,0,"ion-label",8),c.qZA()),2&t){const t=c.oxw();c.xp6(1),c.Q6J("ngForOf",t.userTransactions),c.xp6(1),c.Q6J("ngIf",!t.userTransactions.length)}}function M(t,o){if(1&t&&(c.TgZ(0,"ion-item"),c.TgZ(1,"ion-label",0),c.TgZ(2,"h2",9),c._uU(3),c.qZA(),c.TgZ(4,"p"),c.TgZ(5,"span"),c._uU(6,"Units Consumed "),c.qZA(),c._uU(7),c.qZA(),c.TgZ(8,"p"),c._uU(9),c.qZA(),c.qZA(),c.TgZ(10,"ion-label",10),c.TgZ(11,"p",11),c.TgZ(12,"span"),c._uU(13,"\u20b9"),c.qZA(),c._uU(14),c.qZA(),c.TgZ(15,"p"),c._uU(16),c.qZA(),c.qZA(),c.qZA()),2&t){const t=o.$implicit,n=c.oxw(3);c.xp6(3),c.Oqu(t.siteName),c.xp6(4),c.Oqu(n.formatter(t.unitsConsumed)),c.xp6(2),c.Oqu(n.dateFormatter(t.transactionStartTime)),c.xp6(5),c.hij(" ",n.formatter(t.transactionAmount),""),c.xp6(2),c.Oqu(null==t.paymentMode?"NA":t.paymentMode)}}function v(t,o){1&t&&(c.TgZ(0,"ion-label",12),c._uU(1,"No transactions"),c.qZA())}function A(t,o){if(1&t&&(c.TgZ(0,"ion-list",14),c.TgZ(1,"ion-list-header",0),c._uU(2),c.qZA(),c.YNc(3,M,17,5,"ion-item",7),c.YNc(4,v,2,0,"ion-label",8),c.qZA()),2&t){const t=o.$implicit,n=c.oxw(2);c.xp6(2),c.hij(" ",n.getListHeader(t)," "),c.xp6(1),c.Q6J("ngForOf",n.overallData[t]),c.xp6(1),c.Q6J("ngIf",!n.overallData[t].length)}}function q(t,o){if(1&t&&(c.TgZ(0,"div"),c.YNc(1,A,5,3,"ion-list",13),c.qZA()),2&t){const t=c.oxw();c.xp6(1),c.Q6J("ngForOf",t.lastThreeMonths)}}const w=[{path:"",component:(()=>{class t{constructor(t,o,n,e,a){this.dashboardService=t,this.alertService=o,this.loaderService=n,this.storage=e,this.popoverController=a,this.currentMonthTransactions=[],this.lastMonthTransactions=[],this.lastToLastMonthTransactions=[],this.showAll=!1,this.overallData={},this.lastThreeMonths=[]}ngOnInit(){this.storage.setItem("SELECTED_FILTER","last3month"),this.lastMonthName=h().subtract(1,"month").format("MMMM, YYYY"),this.lastToLastMonthName=h().subtract(2,"month").format("MMMM, YYYY"),this.dashboardService.getUserTransactions().subscribe(t=>{!1===t.hasError&&(this.userTransactions=t.userTransactionViewModels,this.userTransactions.sort((t,o)=>{var n=new Date(t.transactionStartTime);return new Date(o.transactionStartTime)-n}),this.showLast3MonthsTransactions())},t=>{this.alertService.presentToast(l.E.HTTP_RESPONSE_ERROR),this.loaderService.hideLoader()})}formatter(t){return Number(t).toFixed(2)}dateFormatter(t){return h(new Date(t+"Z")).utcOffset(330).format("DD MMM YYYY, hh:mm A")}getListHeader(t){let o=h().format("M"),n=h().subtract(1,"month").format("M"),e=h().subtract(2,"month").format("M"),a=h().subtract(2,"month").format("MMMM, YYYY");return+t==+o?"This Month":+t==+n?"Last Month":+t==+e?a:void 0}openFilterOptions(t){return(0,r.mG)(this,void 0,void 0,function*(){const o=yield this.popoverController.create({component:m,cssClass:"my-custom-class",event:t,translucent:!0});yield o.present();const{data:n}=yield o.onDidDismiss();"all"===(null==n?void 0:n.data)&&(this.showAll=!0),"currentmonth"===(null==n?void 0:n.data)&&this.showCurrentMonthTransactions(),"lastmonth"===(null==n?void 0:n.data)&&this.showLastMonthTransactions(),"last3month"===(null==n?void 0:n.data)&&this.showLast3MonthsTransactions()})}showLast3MonthsTransactions(){this.showAll=!1;var t=h().format("M"),o=h().month(h().subtract(1,"month").format("MMMM")).format("M"),n=h().month(h().subtract(2,"month").format("MMMM")).format("M"),e=(new Date).getFullYear(),a=(new Date).getFullYear()-1;this.lastThreeMonths=[t,o,n],this.lastThreeMonths.forEach(t=>{this.overallData[t]||(this.overallData[t]=[])}),this.userTransactions.filter(s=>{var[i,r]=s.transactionStartTime.split("-");+r==+t&&+i==+e&&this.overallData[t].push(s),(+r==+o&&+i==+e||+r==+o&&+i==+a)&&this.overallData[o].push(s),(+r==+n&&+i==+e||+r==+n&&+i==+a)&&this.overallData[n].push(s)})}showCurrentMonthTransactions(){this.showAll=!1,this.overallData={};var t=h().format("M"),o=(new Date).getFullYear();this.lastThreeMonths=[t],this.lastThreeMonths.forEach(t=>{this.overallData[t]||(this.overallData[t]=[])}),this.userTransactions.filter(n=>{var[e,a]=n.transactionStartTime.split("-");+a==+t&&+e==+o&&this.overallData[t].push(n)})}showLastMonthTransactions(){this.showAll=!1,this.overallData={},h().format("M");var t=(new Date).getFullYear(),o=h().month(h().subtract(1,"month").format("MMMM")).format("M"),n=(new Date).getFullYear()-1;this.lastThreeMonths=[o],this.lastThreeMonths.forEach(t=>{this.overallData[t]||(this.overallData[t]=[])}),this.userTransactions.filter(e=>{var[a,s]=e.transactionStartTime.split("-");(+s==+o&&+a==+t||+s==+o&&+a==+n)&&this.overallData[o].push(e)})}}return t.\u0275fac=function(o){return new(o||t)(c.Y36(g.u),c.Y36(Z.c),c.Y36(p.D),c.Y36(u.V),c.Y36(s.Dh))},t.\u0275cmp=c.Xpm({type:t,selectors:[["app-transaction"]],decls:13,vars:2,consts:[["color","primary"],["slot","start"],["name","grid-outline"],["slot","end"],[3,"click"],["name","funnel-outline"],[4,"ngIf"],[4,"ngFor","ngForOf"],["class","ion-padding","style","margin-top: 1rem;","color","primary",4,"ngIf"],[2,"font-weight","500"],["color","primary","slot","end","color","primary",2,"text-align","right"],[2,"font-size","24px","font-weight","500"],["color","primary",1,"ion-padding",2,"margin-top","1rem"],["style","margin-bottom: 1rem; padding-top: 0 !important;",4,"ngFor","ngForOf"],[2,"margin-bottom","1rem","padding-top","0 !important"]],template:function(t,o){1&t&&(c.TgZ(0,"ion-header"),c.TgZ(1,"ion-toolbar",0),c.TgZ(2,"ion-buttons",1),c.TgZ(3,"ion-menu-button"),c._UZ(4,"ion-icon",2),c.qZA(),c.qZA(),c.TgZ(5,"ion-title"),c._uU(6," My Transactions "),c.qZA(),c.TgZ(7,"ion-buttons",3),c.TgZ(8,"ion-button",4),c.NdJ("click",function(t){return o.openFilterOptions(t)}),c._UZ(9,"ion-icon",5),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.TgZ(10,"ion-content"),c.YNc(11,f,3,2,"ion-list",6),c.YNc(12,q,2,1,"div",6),c.qZA()),2&t&&(c.xp6(11),c.Q6J("ngIf",o.showAll),c.xp6(1),c.Q6J("ngIf",!o.showAll))},directives:[s.Gu,s.sr,s.Sm,s.fG,s.gu,s.wd,s.YG,s.W2,e.O5,s.q_,e.sg,s.Ie,s.Q$,s.yh],styles:[""]}),t})(),resolve:{}}];let Y=(()=>{class t{}return t.\u0275fac=function(o){return new(o||t)},t.\u0275mod=c.oAB({type:t}),t.\u0275inj=c.cJS({imports:[[e.ez,a.u5,s.Pc,i.Bz.forChild(w)]]}),t})()}}]);