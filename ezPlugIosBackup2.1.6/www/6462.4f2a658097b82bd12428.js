(self.webpackChunkeZPlug=self.webpackChunkeZPlug||[]).push([[6462],{6462:(t,e,i)=>{"use strict";i.r(e),i.d(e,{BillPageModule:()=>I});var n=i(8583),o=i(665),a=i(5298),r=i(7823),s=i(4762),c=i(5466),d=i(6738),g=i(7481),h=i(7716),l=i(7906),p=i(4471),m=i(3760),u=i(6773),b=i(5970);function v(t,e){1&t&&h._UZ(0,"ion-spinner",17)}function T(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-col",5),h.TgZ(1,"ion-row",6),h.TgZ(2,"ion-col",5),h._UZ(3,"ion-img",7),h.TgZ(4,"h4",8),h.TgZ(5,"ion-text",0),h._uU(6,"Invoice"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(7,"ion-col",5),h.TgZ(8,"ion-row",9),h.TgZ(9,"ion-col",10),h.TgZ(10,"h6"),h.TgZ(11,"ion-text",0),h._uU(12,"Charge Duration"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(13,"ion-col",11),h.TgZ(14,"p"),h.TgZ(15,"ion-text",0),h._uU(16),h.qZA(),h.qZA(),h.qZA(),h.TgZ(17,"ion-col",10),h.TgZ(18,"h6"),h.TgZ(19,"ion-text",0),h._uU(20,"Energy Consumed"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(21,"ion-col",11),h.TgZ(22,"p"),h.TgZ(23,"ion-text",0),h._uU(24),h.qZA(),h.qZA(),h.qZA(),h.TgZ(25,"ion-col",10),h.TgZ(26,"h6"),h.TgZ(27,"ion-text",0),h._uU(28,"Bill Charged"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(29,"ion-col",11),h.TgZ(30,"p"),h.TgZ(31,"ion-text",0),h._uU(32),h.qZA(),h.qZA(),h.qZA(),h.TgZ(33,"ion-col",10),h.TgZ(34,"h6"),h.TgZ(35,"ion-text",0),h._uU(36,"Other Charges"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(37,"ion-col",11),h.TgZ(38,"p"),h.TgZ(39,"ion-text",0),h._uU(40),h.qZA(),h.qZA(),h.qZA(),h._UZ(41,"ion-item-divider",12),h.TgZ(42,"ion-col",10),h.TgZ(43,"h6"),h.TgZ(44,"ion-text",0),h._uU(45,"Total"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(46,"ion-col",11),h.TgZ(47,"p"),h.TgZ(48,"ion-text",0),h._uU(49),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(50,"ion-row",13),h.TgZ(51,"ion-col",14),h.TgZ(52,"ion-button",15),h.NdJ("click",function(){return h.CHM(t),h.oxw().makePaymentUsingWallet()}),h.YNc(53,v,1,0,"ion-spinner",16),h._uU(54,"Payment"),h.qZA(),h.qZA(),h.qZA(),h.qZA()}if(2&t){const t=h.oxw();h.xp6(16),h.hij("",t.convertToTimeFormat(t.energyConsumed_Time)," hour"),h.xp6(8),h.hij("",t.returnNumber(t.invoiceData.units)," kWh"),h.xp6(8),h.hij("\u20b9 ",t.returnNumberPrice(t.invoiceData.perUnitTotalCost),""),h.xp6(8),h.hij("\u20b9 ",t.returnNumberPrice(t.invoiceData.serviceCharge+t.invoiceData.baseTransactionFee),""),h.xp6(9),h.hij("\u20b9 ",t.returnNumberPrice(t.invoiceData.grandTotal),""),h.xp6(4),h.Q6J("ngIf",t.paymentButtonCreateOrderLoader)}}const O=[{path:"",component:(()=>{class t{constructor(t,e,i,n,o,a,r,s,c,d,g){this.dashboardService=t,this.loaderService=e,this.route=i,this.router=n,this.toastController=o,this.modalController=a,this.location=r,this.iab=s,this.signalRService=c,this.alertService=d,this.platform=g,this.time="00:00:00",this.kwh=0,this.cost=0,this.price="",this.paymentLink="",this.orderId="",this.paymentButtonCreateOrderLoader=!1}ngOnInit(){return(0,s.mG)(this,void 0,void 0,function*(){this.dashboardService.getItem(c.E.PRICING_DETAILS).then(t=>{this.price=t}),this.price=yield this.dashboardService.getItem(c.E.PRICING_DETAILS);let t=yield this.dashboardService.getObject(c.E.OTP_SESSION);this.userID=t.user.userId,this.pluggedInTime=yield this.dashboardService.getItem(c.E.PLUGGEDIN_START_TIME),this.dashboardService.getObject(c.E.CHARGING_TRANSACTION_DATA).then(t=>{this.transactionStatus=t,this.time=this.transactionStatus.time,this.paymentLink=this.transactionStatus.paymentLink,this.orderId=this.transactionStatus.orderId,this.transactionStatusID=this.transactionStatus.tid})})}ionViewDidEnter(){return(0,s.mG)(this,void 0,void 0,function*(){this.paymentButtonCreateOrderLoader=!1,this.dashboardService.getObject(c.E.CHARGING_TRANSACTION_DATA).then(t=>{this.transactionStatus=t,this.time=this.transactionStatus.time,this.paymentLink=this.transactionStatus.paymentLink,this.orderId=this.transactionStatus.orderId,this.transactionStatusID=this.transactionStatus.tid}),this.platform.backButton.subscribeWithPriority(9999,()=>{document.addEventListener("backbutton",function(t){this.alertService.presentToast("Please make the payment"),t.preventDefault(),t.stopPropagation()},!1)}),this.dashboardService.getItem(c.E.PRICING_DETAILS).then(t=>{this.price=t}),this.price=yield this.dashboardService.getItem(c.E.PRICING_DETAILS),this.route.queryParams.subscribe(t=>(0,s.mG)(this,void 0,void 0,function*(){if(console.log("nav param...",t.transctionId),t.transctionId)this.dashboardService.getInvoiceDetailsForTransaction(t.transctionId).subscribe(t=>{this.kwh=t.units,this.cost=t.grandTotal,this.energyConsumed_Time=t.timeSpentCharging,this.invoiceData=t});else{this.transactionID=yield this.dashboardService.getItem(c.E.TRANSACTION_ID),console.log("else trans id...",this.transactionID);let t=yield this.dashboardService.getObject(c.E.STATION_DETAILS_INFO);this.stationDetailsStorage=yield this.dashboardService.getObject(c.E.STATION_DETAILS),this.dashboardService.energyConsumedDetails({transactionId:this.transactionID,stationName:this.stationDetailsStorage.stationName,connectorId:1}).subscribe(e=>{this.kwh=e.energyConsumed,this.cost=parseFloat(this.kwh)*parseFloat(t.pricingDetails),this.energyConsumed_Time=e.timeSpentCharging,this.transactionStatusID=e.transactionId,this.generateInvoice()})}}))})}generateInvoice(){return(0,s.mG)(this,void 0,void 0,function*(){let t=yield this.dashboardService.getObject(c.E.STATION_DETAILS),e=yield this.dashboardService.getObject(c.E.STATION_DETAILS_INFO),i=yield this.dashboardService.getObject(c.E.SELECTED_CHARGING_OPTIONS),n={},o=d.now();this.pluggedInTime&&o&&(this.totalTime=(o-this.pluggedInTime)/1e3),this.loaderService.showLoader("Generating invoice..."),this.transactionID=yield this.dashboardService.getItem(c.E.TRANSACTION_ID),n={siteId:e.siteID,stationId:t.stationId,transactionId:this.transactionID,userId:this.userID,chargingOption:i.chargingOption,perUnitPrice:e.pricingDetails,price:this.cost,timeSpentCharging:this.time,units:this.kwh,TotalTransactionTime:this.totalTime},this.signalRService.stopTransaction(),this.dashboardService.generateInvoice(n).subscribe(t=>{!1===t.hasError?(this.invoiceData=t,this.loaderService.hideLoader()):this.loaderService.hideLoader()},t=>{this.alertService.presentToast(c.E.HTTP_RESPONSE_ERROR),this.loaderService.hideLoader()})})}convertToTimeFormat(t){return d().startOf("day").seconds(t).format("HH:mm:ss")}returnNumber(t){return null===t?0:parseFloat(t).toFixed(3)}returnNumberPrice(t){return null===t?0:parseFloat(t).toFixed(2)}createPaymentOrder(){this.paymentButtonCreateOrderLoader=!0;let t={transactionId:this.transactionStatusID,transactionAmount:parseInt(this.invoiceData.grandTotal)};this.dashboardService.paymentCreateOrder(t).subscribe(t=>{!1===t.hasError?(this.paymentOrder=t,this.paymentLink=t.paymentLink,this.orderId=t.orderId,this.paymentButtonCreateOrderLoader=!1):this.paymentButtonCreateOrderLoader=!1},t=>{this.alertService.presentToast(c.E.HTTP_RESPONSE_ERROR),this.paymentButtonCreateOrderLoader=!1})}makePaymentUsingWallet(){return(0,s.mG)(this,void 0,void 0,function*(){this.paymentButtonCreateOrderLoader=!0,this.dashboardService.makePaymentUsingWallet({transactionId:this.transactionStatusID,transactionAmount:this.invoiceData.grandTotal,useWalletBalance:!0,walletAmount:this.invoiceData.grandTotal}).subscribe(t=>{this.dashboardService.removeItem(),this.router.navigate(["app/charge"])})})}makePayment(){return(0,s.mG)(this,void 0,void 0,function*(){this.paymentButtonCreateOrderLoader=!0;let t={transactionId:this.transactionStatusID,transactionAmount:this.invoiceData.grandTotal};this.orderId=yield this.dashboardService.getItem(c.E.ORDER_ID),this.transactionID=yield this.dashboardService.getItem(c.E.TRANSACTION_ID),yield this.dashboardService.getObject(c.E.PAYMENT_ORDER_DATA),this.dashboardService.getPaymentLink(this.orderId).subscribe(t=>{this.paymentLink=t.paymentLink}),null!==this.paymentLink?this.openPaymentInApp():this.dashboardService.paymentCreateOrder(t).subscribe(t=>{!1===t.hasError?(this.dashboardService.setObject(t,c.E.PAYMENT_ORDER_DATA),this.paymentOrder=t,this.paymentLink=t.paymentLink,this.orderId=t.orderId,this.paymentButtonCreateOrderLoader=!1,this.openPaymentInApp()):this.paymentButtonCreateOrderLoader=!1},t=>{this.alertService.presentToast(c.E.HTTP_RESPONSE_ERROR),this.paymentButtonCreateOrderLoader=!1})})}openPaymentInApp(){const t=this.iab.create(this.paymentLink,"_blank",{hideurlbar:"yes",location:"yes",hidenavigationbuttons:"yes"});t.on("loadstop").subscribe(e=>{var i="https://test.cashfree.com/billpay/sim/thankyou";"https://www.cashfree.com/gateway/thankyou"!=e.url&&e.url!=i&&e.url!=`${i}/`||(t.close(),this.loaderService.showLoader("Loading..."),this.dashboardService.paymentOrderStatus({orderId:this.orderId,transactionId:this.transactionStatusID}).subscribe(t=>{!1===t.hasError?(this.paymentOrderStatus=t,this.loaderService.hideLoader(),this.presentModal()):this.loaderService.hideLoader()},t=>{this.loaderService.hideLoader()}))})}closeModal(){return(0,s.mG)(this,void 0,void 0,function*(){this.location.back()})}presentModal(){return(0,s.mG)(this,void 0,void 0,function*(){const t=yield this.modalController.create({component:g.k,cssClass:"my-custom-modal-css",componentProps:this.paymentOrderStatus,backdropDismiss:!1});return yield t.present()})}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(l.u),h.Y36(p.D),h.Y36(a.gz),h.Y36(a.F0),h.Y36(r.yF),h.Y36(r.IN),h.Y36(n.Ye),h.Y36(m.i),h.Y36(u.M),h.Y36(b.c),h.Y36(r.t4))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-bill"]],decls:8,vars:1,consts:[["color","primary"],[1,"login-content","ion-text-center","vertical-align-content"],[2,"height","100%","width","100%"],[2,"width","100%"],["size","12",4,"ngIf"],["size","12"],[1,"ion-justify-content-center",2,"margin-bottom","16px"],["src","../../assets/logo.png",2,"height","80px","width","80px","margin","auto"],[1,"ion-text-center"],[1,"ion-text-left"],["size","7",2,"height","32px"],["size","5",1,"ion-text-right",2,"height","32px"],[2,"margin-top","16px"],[1,"ion-justify-content-center"],["size","10"],["expand","block","color","primary",3,"click"],["name","bubbles",4,"ngIf"],["name","bubbles"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar",0),h.TgZ(2,"ion-title"),h._uU(3,"Bill"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(4,"ion-content",1),h.TgZ(5,"ion-grid",2),h.TgZ(6,"ion-row",3),h.YNc(7,T,55,6,"ion-col",4),h.qZA(),h.qZA(),h.qZA()),2&t&&(h.xp6(7),h.Q6J("ngIf",e.invoiceData))},directives:[r.Gu,r.sr,r.wd,r.W2,r.jY,r.Nd,n.O5,r.wI,r.Xz,r.yW,r.rH,r.YG,r.PQ],styles:["[_nghost-%COMP%]{--page-icon-color:var(--ion-color-secondary);--page-page-color:var(--ion-color-page-content)}.animateButton[_ngcontent-%COMP%]:not([disabled]){color:#fff;border-radius:5px;animation-name:backgroundColorPalette;animation-duration:2s;animation-iteration-count:infinite}@keyframes backgroundColorPalette{0%{background:#216581}50%{background:#4d6e7c}to{background:#002535}}.text-icon-muted[_ngcontent-%COMP%]{color:#21658180!important}.text-muted[_ngcontent-%COMP%]{color:var(--ion-color-primary-tint);font-size:14px}.text-muted-icon[_ngcontent-%COMP%]{--color:rgba(#000,0.5)!important}ion-card[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:36px;display:block;margin:0 auto}ion-range[_ngcontent-%COMP%]{padding-inline-start:16px!important}.avatar-circle[_ngcontent-%COMP%]{width:36px;height:36px;text-align:center;border-radius:50%;-webkit-border-radius:50%;-moz-border-radius:50%;display:table;margin:0 auto}.initials[_ngcontent-%COMP%]{color:#fff;display:table-cell;vertical-align:middle}.item-40px[_ngcontent-%COMP%]{--min-height:44px!important;--max-height:44px!important;height:44px!important;--inner-padding-end:0px!important;--padding-start:0;padding:0 5px}.user-title[_ngcontent-%COMP%]{margin:0;color:var(--ion-color-medium);font-size:16px}ion-content[_ngcontent-%COMP%]{--ion-background-color:var(--page-page-color)}ion-card[_ngcontent-%COMP%]{background-color:#fff!important}.radio-tags[_ngcontent-%COMP%]{padding:0 calc(var(--page-margin) - var(--page-tags-gutter));justify-content:space-between;--radio-tag-color:#000;--radio-tag-background:#fff;--radio-tag-active-color:#fff;--radio-tag-active-background:#000;--radio-tag-icon-color:var(--ion-color-primary)}.radio-tags[_ngcontent-%COMP%]   .radio-tag[_ngcontent-%COMP%]{--padding-start:0px;--inner-padding-end:8px;--inner-padding-start:8px;--min-height:38px;--border-radius:8px;--border-width:1px;--border-style:solid;--border-color:var(--radio-tag-color);--ion-item-background:var(--radio-tag-background);--ion-item-color:var(--radio-tag-color);flex:1}.radio-tags[_ngcontent-%COMP%]   .radio-tag[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:var(--radio-tag-icon-color)}.radio-tags[_ngcontent-%COMP%]   .radio-tag[_ngcontent-%COMP%]   ion-text[_ngcontent-%COMP%]{font-size:14px!important}.radio-tags[_ngcontent-%COMP%]   .radio-tag.item-radio-checked[_ngcontent-%COMP%]{--ion-item-background:var(--radio-tag-active-background);--ion-item-color:var(--radio-tag-active-color)}.radio-tags[_ngcontent-%COMP%]   .radio-tag.item-radio-checked[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#fff}.radio-tags[_ngcontent-%COMP%]   .radio-tag.item-radio-checked[_ngcontent-%COMP%]   ion-text[_ngcontent-%COMP%]{color:#fff;font-size:14px!important}.radio-tags[_ngcontent-%COMP%]   .radio-tag.item-interactive-disabled[_ngcontent-%COMP%]{opacity:.5}.radio-tags[_ngcontent-%COMP%]   .radio-tag.item-interactive-disabled[_ngcontent-%COMP%]   .tag-label[_ngcontent-%COMP%]{font-size:14px!important;opacity:1}.radio-tags[_ngcontent-%COMP%]   .radio-tag[_ngcontent-%COMP%]   .tag-label[_ngcontent-%COMP%]{margin:5px!important;font-size:14px!important;font-weight:500;letter-spacing:.2px;text-align:center}.radio-tags[_ngcontent-%COMP%]   .radio-tag[_ngcontent-%COMP%]   ion-radio[_ngcontent-%COMP%]{margin:0;width:0;--border-width:0px;height:0;--color-checked:#0000}.radio-tags[_ngcontent-%COMP%]   .radio-tag[_ngcontent-%COMP%]{--radio-tag-color:var(--ion-color-primary);--radio-tag-background:var(--ion-color-lightest);--radio-tag-active-color:var(--ion-color-lightest);--radio-tag-active-background:var(--ion-color-primary);margin-right:5px}.range-item[_ngcontent-%COMP%]{--ion-grid-column-padding:0px;padding-inline-start:var(--page-margin);padding-inline-end:var(--page-margin);box-shadow:inset 0 6px 3px -8px var(--ion-color-darkest)}.range-item[_ngcontent-%COMP%]   .range-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding-bottom:calc(var(--page-margin) / 2)}.range-item[_ngcontent-%COMP%]   .range-header[_ngcontent-%COMP%]   .range-value[_ngcontent-%COMP%]{font-size:12px;font-weight:600;letter-spacing:.2px;color:var(--ion-color-primary)}.range-item[_ngcontent-%COMP%]   .range-header[_ngcontent-%COMP%]   .range-label[_ngcontent-%COMP%]{font-size:14px;font-weight:500;letter-spacing:.2px;color:var(--ion-color-primary-tint)}.range-item[_ngcontent-%COMP%]   .range-control[_ngcontent-%COMP%]{--ion-text-color:var(--ion-color-primary);padding-top:0;padding-bottom:0}ion-label[_ngcontent-%COMP%], p[_ngcontent-%COMP%], span[_ngcontent-%COMP%]{color:var(--ion-color-primary)}p[_ngcontent-%COMP%]{margin:0}"]}),t})()}];let I=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=h.oAB({type:t}),t.\u0275inj=h.cJS({imports:[[n.ez,o.u5,r.Pc,a.Bz.forChild(O)]]}),t})()}}]);